\chapter{Cerca de referències}
\label{chapter:search}

%%%% EXTRACCIÓ PDF %%%%
\section{Extracció dels continguts d'un PDF}
El primer pas per poder obtenir la referència d'un article en un fitxer PDF és l'extracció del contingut d'aquest fitxer. Aquest és un dels aspectes que han influït més en l'enfocament que hem donat al sistema, pels motius que es descriuen a continuació.
\paragraph{}
Tal i com ja hem esmentat, en un principi, la solució que es va plantejar era intentar extreure la referència bibliogràfica d'un document directament del fitxer PDF del qual es disposa. Tot i les limitacions que això suposa, després de veure com queden els articles al convertir-los a text ens vam allunyar encara més d'aquesta idea.
\\

\begin{lstlisting}[caption={Text corresponent a la capçalera d'un article després d'haver-lo extret d'un PDF}, label=listing:examplePDFExtraction01]
Characterization and Armstrong Relations for Degenerate Multivalued Dependencies Using Formal Concept Analysis
Jaume Baixeries and Jos´ Luis Balc´zar e a
Dept. Llenguatges i Sistemes Inform`tics, a Universitat Polit`cnica de Catalunya, e c/ Jordi Girona, 1-3, 08034 Barcelona {jbaixer, balqui}@lsi.upc.es

Abstract. Functional dependencies, a notion originated ...
\end{lstlisting}

Els llistats \ref{listing:examplePDFExtraction01} i \ref{listing:examplePDFExtraction02} mostren exemples de les capçaleres de dos articles diferents després d'haver extret el text del fitxer PDF en el que es trobaven. Com es pot veure, el resultat no té cap tipus d'estructura que pugui deixar intuir quina part del text correspon a cada fragment d'informació, sinó que és un conglomerat de totes dades. El primer article comença amb el títol i segueix amb els noms dels dos autors i la informació de la universitat. En canvi, el segon comença amb l'any, la conferència on s'ha presentat, títol i per cada autor es dóna informació diferent sobre la universitat. Si comencem a mirar més articles, el número de casos amb estructures diferents no para d'augmentar (hi ha més exemples a l'apèndix \ref{appendix-pdf2text}).
\\

\begin{lstlisting}[caption={Un altre exemple de text extret d'un PDF}, label=listing:examplePDFExtraction02]
2010 Second International Conference on Future Networks

Cloud Computing Research and Development Trend
Shuai Zhang Hebei Polytechnic University College of Science Hebei Polytechnic University NO.46 Xinhua West Street Tangshan 063009, Hebei Province China zhangshuai@heut.edu.cn Xuebin Chen Hebei Polytechnic University College of Science Hebei Polytechnic University NO.46 Xinhua West Street Tangshan 063009, Hebei Province China chxb@qq.comm
Abstract--With the development of parallel computing, distributed [...]
\end{lstlisting}

Una vegada vistos els resultats, probablement quedin més clara la inviabilitat de la primera opció i per què hem decidit consultar la informació dels articles que hi ha disponible a la xarxa. De totes maneres, continua sent necessària l'extracció del text dels PDFs per tal de poder fer cerques, i cal veure com ho podem fer.

%%%% DIFICULTATS %%%%
\subsection{Dificultats}
Tot hi haver-hi diverses utilitats que permeten l'extracció del contingut d'un fitxer PDF en forma de text pla o HTML, totes presenten problemes similars als de la llista següent:
\begin{itemize}
\item{No extreuen bé els caràcters especials com ara Unicode o lligadures (e.g. \textit{fi} es representa com un sol caràcter)} 

\item{Sub/Superíndexs:}
la majoria d'eines els extreuen com text que forma part de la paraula. Per exemple: \textit{Joan$^{3}$} s'extreu com a \textit{Joan3}

\item{Flux del text dins del fitxer:}
Hi ha casos en que el text es troba en diferents columnes i a l'hora d'agafar-lo, aquestes columnes o seccions no han d'estar mesclades.

\item{Fragmentació de paràgrafs:}
Relacionat amb el punt anterior. Hi ha ocasions on els paràgrafs es divideixen en un conjunt de línies segons com es troben posicionades dins del document. El text resultant conté salts de línia addicionals que s'han introduït per conservar les mateixes línies del document original, sense tenir en compte l'estructura lògica.
\item{Fitxers protegits dels quals no es pot extreure el contingut}
\end{itemize}

\paragraph{}
Una altra situació en que no serem capaços d'extreure el text del PDF és en aquells casos que els fitxers enlloc de contenir text, contenen imatges amb el document escanejat i no han estat processats per cap programari de reconeixement de caràcters. Pel que hem vist, això sol passar sobretot per articles de fa uns quants anys.

%%%% PROGRAMARI %%%%
\subsection{Programari}
El llistat de programari lliure disponible per a dur a terme l'extracció del contingut és força reduït i totes presenten alguns dels problemes (o tots) que acabem de comentar. Tot i així, hem tingut en compte diverses opcions abans d'escollir una biblioteca o aplicació d'extracció. Hem contemplat: \textit{PyPDF}, \textit{PDFMiner}, \textit{PDFBox}, però finalment ens hem decantat per \textit{xPDF}.

\paragraph{}
\textit{xPDF} consisteix en un conjunt d'eines executables des de la línia de comandes que permeten extreure text i altres elements dels fitxers PDF. Es distribueixen sota la llicència GPL v.2 i hi ha binaris tant per Windows com per Linux (que també funcionen per Mac OS). El motiu principal pel qual hem escollit aquesta eina és que s'obtenen resultats relativament bons. En especial, és interessant el fet que no separa els paràgrafs en diferents línies i que en la majoria dels casos respecta el flux del text dins del document. 

\paragraph{}
Pel que fa als caràcters especials, transforma bé les lligadures en múltiples caràcters, però té problemes amb la codificació Unicode. Donat que la majoria dels articles científics estan escrits en anglès, aquest és un problema que hem decidit obviar. Tal i com veurem, a no ser que l'article contingui un percentatge molt elevat d'aquest tipus de caràcters, serà igualment possible extreure'n la referència.

%%%% CONSULTES %%%%
 \section{Consultes}
 \label{section:chapter-search:consultes}
El més important per poder cercar referències bibliogràfiques a Internet és ser capaços de generar consultes que retornin bons resultats. Per fer-ho, agafarem porcions del text extret amb l'eina \textit{xPDF} i les utilitzarem per obtenir resultats que hi coincideixin exactament. 

\paragraph{}
Una primera idea pot consistir en cercar segons el títol de la publicació de la qual volem informació. El problema és que bona part dels resultats corresponen a pàgines que fan referència a aquesta publicació, però que no en donen gaires detalls. Agafant la resta d'informació de la capçalera (e.g. autors, revista) les consultes encara seran menys restrictives i retornaran resultats pitjors. Per una altra banda, si intentem fer consultes a partir del contingut del mateix article ens trobem amb que en molts casos, els cercadors no el tenen indexat. 

\paragraph{}
Una tercera opció, que és la que utilitzem, consisteix en generar les consultes a partir del resum o \textit{abstract} que acompanya a la majoria d'articles i que també acostuma a aparéixer a les pàgines que contenen la referència. Però com podem saber quina part del text que hem extret correspon al resum? Tot i que en moltes vegades el primer paràgraf va precedit de la paraula \textit{Abstract}, també n'hi ha moltes altres en que va precedit d'una paraula completament diferent (e.g. resum o \textit{summary}) o bé per cap. Per tal que el sistema sigui el més general possible, enlloc de fixar-nos en paraules concretes fem servir una expressió regular molt simple que permet trobar cadenes amb un número de paraules determinat. 

\paragraph{}
Un dels trets característics de les capçaleres dels articles una vegada n'hem extret el text és que contenen un nombre elevat de símbols especials. Això ens pot ajudar a distingir entre les parts corresponents a la capçalera i el resum. L'expressió regular que obté les consultes és: \verb=([\w()?!]+[ ]){min,max}= i agafarà seqüències de \textit{min} a \textit{max} paraules separades per un espai i formades per caràcters alfanumèrics i un nombre limitat de símbols. Els paràmetres \textit{min} i \textit{max} són configurables. Òbviament, les consultes que ens dóna aquesta expressió no sempre són bones i per tal de contrarrestar aquests errors, en generem vàries i les anem utilitzant mentre no s'obtinguin resultats satisfactoris. De totes maneres, tal i com es pot veure al capítol \ref{chapter:results}, no és necessari ni generar moltes consultes ni cal que aquestes siguin gaire llargues.

\paragraph{}
A continuació es llisten cinc consultes extretes d'un article d'exemple. Noteu que s'envolten de cometes dobles, la forma habitual d'indicar als cercadors que les coincidències han de ser exactes.
\begin{itemize}
\item{``are known to admit interesting characterizations in terms of Formal''}
\item{``natural extensions of the notion of functional dependency are the''}
\item{``We propose here a new Galois''}
\item{``which gives rise to a formal concept lattice corresponding precisely''}
\item{``the degenerate multivalued dependencies that hold in the relation''}
\end{itemize}

\paragraph{}
\label{chapter:search:skip-queries}
En molts casos, l'expressió regular anterior també dóna coincidències pel títol de l'article. Per evitar el problema que hem descrit, hi ha definit un altre paràmetre que estableix el nombre de consultes a saltar-se des del principi de l'article. És una manera rudimentària d'aconseguir-ho, però funciona la majoria de vegades.



%%%% CERCADORS %%%%
\section{Cercadors}
\label{section:search:searchers}
El següent pas després d'haver obtingut un conjunt de consultes és utilitzar-les amb un cercador per tal d'obtenir pàgines amb informació de la referència que volem aconseguir. Al capítol d'introducció, hem esmentat que hi ha cercadors com ara \textit{Google Scholar} o \textit{Microsoft Academic Search} on els resultats només corresponen a publicacions. En un principi ens va semblar raonable intentar fer ús d'aquests serveis per poder aconseguir els nostres objectius. El problema és que no tenen cap API publicada que permeti fer consultes automàtiques des d'aplicacions de tercers. Tot i que hi ha solucions i \textit{workarounds}, van en contra dels termes i condicions i els servidors bloquegen massa consultes seguides. Per tant, hem descartat aquesta opció.

\paragraph{}
Així doncs, ens quedem amb els cercadors habituals; hem preparat la nostra aplicació per tal d'utilitzar les APIs de \textit{Google}, \textit{Yahoo} i \textit{Bing}. Tots tres cercadors retornen els resultats en format JSON. Els principals inconvenients són que retornen qualsevol tipus de pàgina i que no tenen indexades algunes blioteques digitals. Tot i així, també podem aconseguir bons resultats amb l'ús de les consultes adequades. Al capítol de resultats (\ref{chapter:results:section:search}) hi ha una comparativa.


%%%% ORDENACIÓ RESULTATS %%%%
\subsection{Ordenació de resultats}
La majoria de vegades, no ens convindrà l'ordre dels resultats donat pels diferents cercadors sinó que voldrem processar les pàgines segons aquelles per les quals tenim regles d'extracció. És per això que un cop hem consultat al cercador, comprovem si tenim regles per alguna de les pàgines resultants i, en cas afirmatiu, la movem a dalt de tot de la llista.

\paragraph{}
En cas d'haver-hi múltiples pàgines de les quals sabem extreure les dades, ho farem segons una puntuació assignada a les regles de les que disposem. Aquest tema de les puntuacions es tracta amb més detall al capítol sobre generació de \textit{wrappers} (\ref{chapter:wrapperinduction}).


%%%% AJUSTAMENTS %%%%
\subsection{Altres Ajustaments}
Depenent de l'estructura del contingut dels fitxers dels que disposem, la qualitat dels resultats obtinguts amb els cercadors pot variar considerablement. Això suposa la necessitat d'ajustar alguns paràmetres per tal de poder adaptar el sistema a l'ús de cadascú. A la secció sobre la generació de consultes (\ref{section:chapter-search:consultes}), ja hem comentat la possibilitat d'ajustar el mínim i màxim de termes a cercar, però hi ha altres opcions que es poden configurar.

\paragraph{}
En algunes ocasions, es dóna el cas que la consulta generada no és prou restrictiva, ja sigui perquè no és prou llarga o bé perquè està formada per paraules molt generals. Al cercar amb aquestes consultes s'obté una llarga llista de resultats, la majoria dels quals no tenen res a veure amb la informació que estem buscant. Per contrarestar-ho, hi ha la possibilitat d'indicar al sistema que ometi els resultats i provi amb la següent consulta. A l'hora d'assignar el valor d'aquest paràmetre, també s'haurà de tenir en compte el tipus d'articles dels que es vol informació. Per exemple, els articles populars segurament tindran un número de coincidències rellevants gran i, per tant, haurem d'assignar un valor relativament alt, ja que un valor baix farà que descartem resultats bons. En canvi, per articles poc corrents, ens interessarà el contrari.

\paragraph{}
Per una altra banda,  hi ha ocasions en que els cercadors tenen tendència a retornar resultats que, tot i coincidir amb la consulta que li hem donat, corresponen a una pàgina que no ens aporta massa informació. Per tal d'ajudar a l'aplicació a descartar resultats dolents, podem indicar-li pàgines que volem ometre a partir d'una llista negra. Per exemple, sabem que les pàgines sobre els autors de la biblioteca digital \textit{ACM Portal} contenen un llistat de tots els articles d'un mateix autor, però que no contenen suficient informació com per extreure referències. En aquest cas voldrem descartar els resultats que comencen per \href{http://portal.acm.org/author\_page.cfm?id=}{http://portal.acm.org/author\_page.cfm}.

\section{\textit{Multithreading}}
Un dels inconvenients més grans que implica el fet d'haver d'accedir a Internet, és que el temps perdut esperant dades és molt alt. Per reduir-lo, s'ha estudiat la possibilitat d'utilitzar diferents fils d'execució per fer més d'una consulta de forma més o menys simultània. La taula següent mostra una comparativa del temps necessari per obtenir mútliples pàgines web de forma seqüencial o bé utilitzant fins a cinc fils d'execució diferents. Les pàgines pàgines corresponen a consultes aleatòries a \textit{Google} per evitar l'efecte dels \textit{proxies} i \textit{caches}. 

    \begin{center}
    \begin{tabular}{|r|r|r|r|r|r|r|r|}
        \hline
        \multicolumn{2}{|c|}{2 pàgines} & \multicolumn{2}{|c|}{5 pàgines} & \multicolumn{2}{|c|}{10 pàgines} & \multicolumn{2}{|c|}{20 pàgines} \\
        \hline
        Seq. & 5 Threads          & Seq. & 5 Threads          & Seq. & 5 Threads           & Seq. & 5 Threads \\
        \hline
        \hline
        0.9010 & 0.5481 & 2.1830 & 0.6612 & 4.3153 & 1.5914 & 7.9295 & 2.5949 \\
        0.7467 & 0.3795 & 2.1558 & 0.7441 & 4.3186 & 1.2311 & 8.5483 & 2.1958 \\ 
        0.7678 & 0.5641 & 2.0645 & 0.5383 & 9.2930 & 1.4415 & 8.7202 & 2.5749 \\
        0.7421 & 0.3876 & 2.0684 & 0.8551 & 4.9859 & 1.5294 & 8.4732 & 2.2841 \\
        0.9674 & 0.5477 & 2.1510 & 0.8550 & 5.3600 & 1.3116 & 9.2901 & 2.2257 \\
        \hline
        \multicolumn{8}{|l|}{Mitjana:} \\
        \hline
        0.8250 & 0.4854 & 2.1246 & 0.7307 & 5.6546 & 1.4210 & 8.5923 & 2.3751 \\
        \hline
        \multicolumn{8}{|l|}{Guany:} \\
        \hline
        \multicolumn{2}{|c|}{\textbf{-44.96\%}} &  \multicolumn{2}{|c|}{\textbf{-65.6\%}} &  \multicolumn{2}{|c|}{\textbf{-74.87\%}} &  \multicolumn{2}{|c|}{\textbf{-72.35\%}} \\
        \hline
    \end{tabular}
    \end{center}

Tot i que aquestes proves no són riguroses, sí que són suficients per poder-nos fer una idea força clara sobre la millora que s'obté utilitzant múltiples fils respecte no fer-ho. Pere exemple, per obtenir 5 pàgines amb un sol fil només es tarda lleugerament menys que per obtenir-ne 20 amb 5 fils.

\paragraph{}
Pel que fa a la forma d'implementar-ho, hem creat un \textit{pool} amb un número màxim configurable de fils d'execució que es van reutilitzant mentre queden referències per extreure. Bàsicament, tenim una cua amb les rutes als fitxers PDF i una cua de sortida amb el resultat d'extreure les referències. Cada \textit{thread} va processant fitxers de la cua d'entrada mentre aquesta no és buida. El número de fils s'haurà d'ajustar segons del tipus de connexió del que es disposi.
